# Reading_files

# Сопоставление сетки с кластерами

Этот Python-скрипт сопоставляет конечные элементы из сетки (`nodes.txt`) с ближайшими облаками точек (кластерами), хранящимися в `.ply` файлах в папке `Partitions`.

## Функциональность
- **Входные данные**:
  - `nodes.txt`: Содержит данные сетки с узлами (id, x, y, z) и тетраэдральными элементами (id элемента, 4 id узлов).
  - `.ply` файлы: Облака точек в папке `Partitions`, представляющие кластеры.
- **Обработка**:
  - Читает данные сетки с помощью `read_mesh_file`, разбирая узлы и элементы.
  - Загружает вершины из `.ply` файлов с использованием `trimesh` в массивы NumPy.
  - Вычисляет центроид каждого тетраэдрального элемента как среднее его четырёх вершин.
  - Строит KDTree (`scipy.spatial.KDTree`) для каждого облака точек для эффективного поиска ближайшей точки.
  - Использует `multiprocessing.Pool` для параллельной обработки, определяя ближайший кластер для каждого элемента на основе евклидова расстояния от центроида элемента.
- **Вывод**: Печатает пары идентификаторов элементов и соответствующих им индексов ближайших кластеров.

## Технические детали
- **Зависимости**: `numpy`, `trimesh`, `scipy`, `multiprocessing`.
- **Предположения о данных**:
  - Элементы — тетраэдры (4 вершины).
  - `nodes.txt` имеет определённый формат: первая строка — количество узлов и элементов, затем координаты узлов, пустая строка и определения элементов.
  - `.ply` файлы валидны и содержат 3D-облака точек.
- **Обработка ошибок**: Проверяет наличие файлов и корректность количества вершин элементов.
- **Производительность**: Использует KDTree для эффективного поиска ближайших соседей и многопроцессорность для параллельной обработки элементов.

## Использование
1. Убедитесь, что `nodes.txt` находится в рабочей директории, а `.ply` файлы — в папке `Partitions`.
2. Установите зависимости: `pip install numpy trimesh scipy`.
3. Запустите скрипт: `python Read.py`.
4. Вывод: Список идентификаторов элементов и их ближайших кластеров.

## Пример
Для сетки с 7572 узлами и 36994 элементами и несколькими `.ply` файлами в `Partitions` скрипт выведет:
```
Число узлов: 7572
Число элементов: 36994
Найдено X кластеров (ply файлов).
Список: Номер КЭ - номер кластера
1 - 1
2 - 3
...

## Примечания
- Убедитесь, что достаточно памяти для больших сеток или облаков точек.
- Скрипт предполагает, что все элементы — тетраэдры; другие типы элементов могут вызвать ошибки.
